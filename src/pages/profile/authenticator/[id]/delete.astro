---
import { deleteAuthenticator } from '$lib/auth/profileApi'
import { checkJwtOrRedirect } from '$lib/auth/util'

const jwt = checkJwtOrRedirect(Astro)
if (jwt instanceof Response) {
  return jwt
}

if (Astro.request.method !== 'POST') {
  return new Response('invalid method', {
    status: 405,
    headers: {
      'Content-Type': 'text/plain',
    },
  })
}

const { id } = Astro.params

await deleteAuthenticator(jwt, id!)

return Astro.redirect('/profile')
---
