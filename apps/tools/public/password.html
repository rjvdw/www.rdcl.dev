<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex,nofollow">

  <title>generate password | rdcl.dev</title>

  <style>
    .upper-lower-case {
      float: left;
      width: 0;
      height: 0;
      visibility: hidden;
    }

    .upper-lower-case + span > .upper {
      color: #aaa;
      text-decoration: none
    }

    .upper-lower-case:checked + span > .upper {
      color: #000;
      text-decoration: underline
    }

    .upper-lower-case + span > .lower {
      color: #000;
      text-decoration: underline
    }

    .upper-lower-case:checked + span > .lower {
      color: #aaa;
      text-decoration: none
    }
  </style>
</head>

<body>

<a href="/tools/">Back to index</a>

<main>
  <h1>Generate Password</h1>

  <p>
    This tool uses the <code>window.crypto</code> library to securely generate a password in your browser.
    No external libraries (CSS or JavaScript) are loaded on this page (which is also why this page looks a little primitive).
    The algorithm works by first getting 80 bits of random data from the <code>window.crypto</code> library.
    These bits are then encoded using a base 32 encoding.
    In the resulting password, only letters and numbers are used (with dashes added for readability).
    The letters I, L, O, and U are not used (as recommended by <a href="http://www.crockford.com/wrmg/base32.html">Douglas Crockford</a>).
  </p>

  <form id="form">
    <input type="text" readonly id="output" onclick="this.select()" style="width:200px">
    <label style="cursor:pointer">
      <input type="checkbox" class="upper-lower-case">
      <span><span class="upper">A</span><span class="lower">a</span></span>
    </label>
    <button type="submit">Generate</button>
    <button type="reset">Clear</button>
  </form>
</main>

<script>
  (function () {
    'use strict'

    const $ = s => document.querySelector(s)
    const alphabet = '0123456789abcdefghjkmnpqrstvwxyz'
    const output = $('#output')
    let uppercase = false
    const setCase = v => v[uppercase ? 'toUpperCase' : 'toLowerCase']()

    $('.upper-lower-case').addEventListener('click', event => {
      uppercase = event.target.checked
      output.value = setCase(output.value)
      output.select()
    }, false)

    $('button[type="reset"]').addEventListener('click', event => {
      event.preventDefault()
      output.value = ''
    }, false)

    $('#form').addEventListener('submit', event => {
      event.preventDefault()
      output.value = setCase(Bits.generate())
      output.select()
    }, false)

    class Bits {
      constructor() {
        this._result = ''
        this._buffer = 0
        this._index = 0
      }

      push(c) {
        for (let i = 8 ; i > 0 ; i -= 1) {
          const b = (c >>> (i - 1)) & 1

          this._buffer = b + (this._buffer << 1)
          this._index += 1

          if (this._index === 5) {
            this._result += alphabet[this._buffer]
            this._buffer = 0
            this._index = 0
          }
        }
      }

      toString() {
        return this._result
      }

      static generate() {
        const buffer = new Uint8Array(10)
        const bits = new Bits()
        window.crypto.getRandomValues(buffer)
        for (const c of buffer) bits.push(c)

        return bits.toString().match(/.{4}/g).join('-')
      }
    }
  })()
</script>

</body>
</html>
